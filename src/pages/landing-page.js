'use strict';

(function (window, document, undefined, paneiro, jambo) {
  Polymer({
    is: 'landing-page',

    properties: {
      route: Object
    },

    onCallToActionTap: function onCallToActionTap() {
      var authToken = jambo.getCookie('userToken');
      if (authToken && authToken !== '') {
        this.set('route.path', '/loja/categoria/petshop');
      } else {
        this.$.loadingMsg.style.display = 'none';
        this.$.loginModal.open();
      }
    },

    onLoginModalOkButtonTap: function onLoginModalOkButtonTap() {
      if (!this.$.loginModalForm.validate()) {
        return;
      }

      this.$.loginModalForm.submit();
    },

    onLoginModalFormPreSubmit: function onLoginModalFormPreSubmit(e) {
      e.preventDefault();

      this.$.loadingMsg.style.display = 'block';

      var that = this;
      jambo.ajax({
        url: '//api.paneirovirtual.com/v1/auth',
        method: 'POST',
        data: this.$.loginModalForm.serialize()
      }).then(function (response) {
        that.handleAuthSuccess(response);
      }).catch(function (response) {
        that.handleAuthError(response);
      });
    },

    handleAuthSuccess: function handleAuthSuccess(response) {
      this.$.loginModal.close();
      if (response.status === 'OK') {
        jambo.setCookie('userToken', response.data, {
          path: '/',
          expires: 1440
        });
        paneiro.userToken = response.data;

        this.set('route.path', '/loja/categoria/petshop');
      }
    },

    handleAuthError: function handleAuthError(response) {
      this.$.loginModal.close();
      if (response.status === 'ZERO_RESULTS') {
        this.set('route.path', '/cadastro');
      } else if (response.status === 'NOT_AUTHORIZED') {
        this.$.errorModalTitle.innerHTML = 'Seu cadastro j치 foi registrado.';
        this.$.errorModalMsg.innerHTML = 'Seu pedido de acesso j치 est치 registrado, em breve entraremos em contato.';
        this.$.errorModal.open();
      } else {
        this.$.errorModalTitle.innerHTML = 'Erro ao autenticar usu치rio.';
        this.$.errorModalMsg.innerHTML = 'Aconteceu um erro ao validar o seu email. Por favor tente novamente em alguns instantes.';
        this.$.errorModal.open();
      }
    }
  });
})(window, document, undefined, paneiro, jambo);
//# sourceMappingURL=data:application/json;base64,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QXhFUCxFQXdFZSxRQXhFZixFQXdFeUIsU0F4RXpCLEVBd0VvQyxPQXhFcEMsRUF3RTZDLEtBeEU3QyIsImZpbGUiOiJwYWdlcy9sYW5kaW5nLXBhZ2UuanMiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24od2luZG93LCBkb2N1bWVudCwgdW5kZWZpbmVkLCBwYW5laXJvLCBqYW1ibykge1xuICAgICAgUG9seW1lcih7XG4gICAgICAgIGlzOiAnbGFuZGluZy1wYWdlJyxcblxuICAgICAgICBwcm9wZXJ0aWVzOiB7XG4gICAgICAgICAgcm91dGU6IE9iamVjdFxuICAgICAgICB9LCAgICAgICAgICAgICAgICBcblxuICAgICAgICBvbkNhbGxUb0FjdGlvblRhcDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgdmFyIGF1dGhUb2tlbiA9IGphbWJvLmdldENvb2tpZSgndXNlclRva2VuJyk7XG4gICAgICAgICAgaWYgKGF1dGhUb2tlbiAmJiBhdXRoVG9rZW4gIT09ICcnKSB7XG4gICAgICAgICAgICB0aGlzLnNldCgncm91dGUucGF0aCcsICcvbG9qYS9jYXRlZ29yaWEvcGV0c2hvcCcpO1xuICAgICAgICAgIH0gZWxzZSB7ICAgICAgICAgICAgXG4gICAgICAgICAgICB0aGlzLiQubG9hZGluZ01zZy5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnO1xuICAgICAgICAgICAgdGhpcy4kLmxvZ2luTW9kYWwub3BlbigpO1xuICAgICAgICAgIH0gICAgICAgICAgICAgICAgIFxuICAgICAgICB9LCAgICAgIFxuXG4gICAgICAgIG9uTG9naW5Nb2RhbE9rQnV0dG9uVGFwOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICBpZiAoIXRoaXMuJC5sb2dpbk1vZGFsRm9ybS52YWxpZGF0ZSgpKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgfSBcblxuICAgICAgICAgIHRoaXMuJC5sb2dpbk1vZGFsRm9ybS5zdWJtaXQoKTtcbiAgICAgICAgfSwgICAgICBcblxuICAgICAgICBvbkxvZ2luTW9kYWxGb3JtUHJlU3VibWl0OiBmdW5jdGlvbihlKSB7XG4gICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuXG4gICAgICAgICAgdGhpcy4kLmxvYWRpbmdNc2cuc3R5bGUuZGlzcGxheSA9ICdibG9jayc7XG4gICAgICAgICAgXG4gICAgICAgICAgdmFyIHRoYXQgPSB0aGlzO1xuICAgICAgICAgIGphbWJvLmFqYXgoe1xuICAgICAgICAgICAgdXJsOiAnLy9hcGkucGFuZWlyb3ZpcnR1YWwuY29tL3YxL2F1dGgnLFxuICAgICAgICAgICAgbWV0aG9kOiAnUE9TVCcsXG4gICAgICAgICAgICBkYXRhOiB0aGlzLiQubG9naW5Nb2RhbEZvcm0uc2VyaWFsaXplKCkgICAgICAgICAgXG4gICAgICAgICAgfSkudGhlbihmdW5jdGlvbihyZXNwb25zZSkge1xuICAgICAgICAgICAgdGhhdC5oYW5kbGVBdXRoU3VjY2VzcyhyZXNwb25zZSk7XG4gICAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24ocmVzcG9uc2UpIHtcbiAgICAgICAgICAgIHRoYXQuaGFuZGxlQXV0aEVycm9yKHJlc3BvbnNlKTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSxcblxuICAgICAgICBoYW5kbGVBdXRoU3VjY2VzczogZnVuY3Rpb24ocmVzcG9uc2UpIHtcbiAgICAgICAgICB0aGlzLiQubG9naW5Nb2RhbC5jbG9zZSgpOyAgICAgICAgICAgICAgICBcbiAgICAgICAgICBpZiAocmVzcG9uc2Uuc3RhdHVzID09PSAnT0snKSB7XG4gICAgICAgICAgICBqYW1iby5zZXRDb29raWUoJ3VzZXJUb2tlbicsIHJlc3BvbnNlLmRhdGEsIHtcbiAgICAgICAgICAgICAgcGF0aDogJy8nLFxuICAgICAgICAgICAgICBleHBpcmVzOiAxNDQwXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHBhbmVpcm8udXNlclRva2VuID0gcmVzcG9uc2UuZGF0YTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgdGhpcy5zZXQoJ3JvdXRlLnBhdGgnLCAnL2xvamEvY2F0ZWdvcmlhL3BldHNob3AnKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgaGFuZGxlQXV0aEVycm9yOiBmdW5jdGlvbihyZXNwb25zZSkge1xuICAgICAgICAgIHRoaXMuJC5sb2dpbk1vZGFsLmNsb3NlKCk7XG4gICAgICAgICAgaWYgKHJlc3BvbnNlLnN0YXR1cyA9PT0gJ1pFUk9fUkVTVUxUUycpIHtcbiAgICAgICAgICAgIHRoaXMuc2V0KCdyb3V0ZS5wYXRoJywgJy9jYWRhc3RybycpO1xuICAgICAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2Uuc3RhdHVzID09PSAnTk9UX0FVVEhPUklaRUQnKSB7XG4gICAgICAgICAgICB0aGlzLiQuZXJyb3JNb2RhbFRpdGxlLmlubmVySFRNTCA9ICdTZXUgY2FkYXN0cm8gasOhIGZvaSByZWdpc3RyYWRvLic7XG4gICAgICAgICAgICB0aGlzLiQuZXJyb3JNb2RhbE1zZy5pbm5lckhUTUwgPSAnU2V1IHBlZGlkbyBkZSBhY2Vzc28gasOhIGVzdMOhIHJlZ2lzdHJhZG8sIGVtIGJyZXZlIGVudHJhcmVtb3MgZW0gY29udGF0by4nOyAgICAgICAgICBcbiAgICAgICAgICAgIHRoaXMuJC5lcnJvck1vZGFsLm9wZW4oKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy4kLmVycm9yTW9kYWxUaXRsZS5pbm5lckhUTUwgPSAnRXJybyBhbyBhdXRlbnRpY2FyIHVzdcOhcmlvLic7XG4gICAgICAgICAgICB0aGlzLiQuZXJyb3JNb2RhbE1zZy5pbm5lckhUTUwgPSBcbiAgICAgICAgICAgICAgJ0Fjb250ZWNldSB1bSBlcnJvIGFvIHZhbGlkYXIgbyBzZXUgZW1haWwuIFBvciBmYXZvciB0ZW50ZSBub3ZhbWVudGUgZW0gYWxndW5zIGluc3RhbnRlcy4nOyAgICAgICAgICBcbiAgICAgICAgICAgIHRoaXMuJC5lcnJvck1vZGFsLm9wZW4oKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0gICAgICBcbiAgICAgIH0pO1xuICAgIH0pKHdpbmRvdywgZG9jdW1lbnQsIHVuZGVmaW5lZCwgcGFuZWlybywgamFtYm8pOyJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==
