'use strict';

(function (window, document, undefined, paneiro, jambo) {
  Polymer({
    is: 'checkout-page',

    properties: {
      user: Object,
      cart: Object,
      days: {
        type: Array,
        notify: true
      }
    },

    ready: function ready() {
      if (this.cart.items.length === 0) {
        this.$.ironLocation.path = '/loja/categoria/petshop';
      } else {
        var weekDays = ['Dom', 'Seg', 'Ter', 'Qua', 'Qui', 'Sex', 'Sáb'];
        var d = new Date();
        this.days = [];

        if (d.getDay() <= 1) {
          var diff = 3 - d.getDay();
          d.setDate(d.getDate() + diff);
        } else if (d.getDay() <= 4) {
          var diff = 6 - d.getDay();
          d.setDate(d.getDate() + diff);
        } else {
          var diff = 7 - d.getDay() + 3;
          d.setDate(d.getDate() + diff);
        }

        for (var i = 0; i < 4; ++i) {
          this.push('days', {
            label: weekDays[d.getDay()] + ' - ' + d.getDate() + '/' + (d.getMonth() + 1),
            value: d.getFullYear() + '-' + (d.getMonth() + 1) + '-' + d.getDate()
          });

          if (d.getDay() === 3) {
            d.setDate(d.getDate() + 3);
          } else {
            d.setDate(d.getDate() + 4);
          }
        }
      }
    },

    onCheckoutFormPreSubmit: function onCheckoutFormPreSubmit(e) {
      var _this = this;

      e.preventDefault();

      var toast = this.$.toast;
      var modal = paneiro.modals.message;
      var formData = this.$.checkoutForm.serialize();

      toast.open();

      var deliveryDatetime = this.$.dateMenu.selectedItem.getAttribute('data-value') + ' ' + this.$.timeMenu.selectedItem.getAttribute('data-value');
      paneiro.api.purchase.checkout({
        phone: this.user.phone,
        addr: formData.addr,
        deliveryDate: deliveryDatetime
      }).then(function (response) {
        toast.close();

        modal.message = 'Seu pedido foi registrado com sucesso, e será entregue na data e horário agendados.\n' + 'Caso seja necessário, entraremos em contato.\n' + 'Agradecemos a preferência e até a próxima!';
        modal.title = 'Pedido registrado com sucesso.';

        modal.open();

        _this.set('cart.items', []);
        _this.set('cart.total', 0);

        _this.$.ironLocation.set('path', '/loja/categoria/petshop');
      }).catch(function (response) {
        return console.log(response);
      });
    },

    onCheckoutFormButtonTap: function onCheckoutFormButtonTap() {
      if (!this.$.checkoutForm.validate()) {
        return;
      }

      this.$.checkoutForm.submit();
    }
  });
})(window, document, undefined, paneiro, jambo);
//# sourceMappingURL=data:application/json;base64,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RFc7QUFFNUIsY0FBTSxTQUFTLElBRmE7QUFHNUIsc0JBQWM7QUFIYyxPQUE5QixFQUlHLElBSkgsQ0FJUSxvQkFBWTtBQUNsQixjQUFNLEtBQU47O0FBRUEsY0FBTSxPQUFOLEdBQWdCLDBGQUNkLGdEQURjLEdBRWQsNENBRkY7QUFHQSxjQUFNLEtBQU4sR0FBYyxnQ0FBZDs7QUFFQSxjQUFNLElBQU47O0FBRUEsY0FBSyxHQUFMLENBQVMsWUFBVCxFQUF1QixFQUF2QjtBQUNBLGNBQUssR0FBTCxDQUFTLFlBQVQsRUFBdUIsQ0FBdkI7O0FBRUEsY0FBSyxDQUFMLENBQU8sWUFBUCxDQUFvQixHQUFwQixDQUF3QixNQUF4QixFQUFnQyx5QkFBaEM7QUFDRCxPQWxCRCxFQWtCRyxLQWxCSCxDQWtCUztBQUFBLGVBQVksUUFBUSxHQUFSLENBQVksUUFBWixDQUFaO0FBQUEsT0FsQlQ7QUFtQkQsS0E1RUs7O0FBOEVOLDZCQUF5QixtQ0FBVztBQUNsQyxVQUFJLENBQUMsS0FBSyxDQUFMLENBQU8sWUFBUCxDQUFvQixRQUFwQixFQUFMLEVBQXFDO0FBQ25DO0FBQ0Q7O0FBRUQsV0FBSyxDQUFMLENBQU8sWUFBUCxDQUFvQixNQUFwQjtBQUNEO0FBcEZLLEdBQVI7QUFzRkQsQ0F2RkwsRUF1Rk8sTUF2RlAsRUF1RmUsUUF2RmYsRUF1RnlCLFNBdkZ6QixFQXVGb0MsT0F2RnBDLEVBdUY2QyxLQXZGN0MiLCJmaWxlIjoicGFnZXMvY2hlY2tvdXQtcGFnZS5qcyIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbih3aW5kb3csIGRvY3VtZW50LCB1bmRlZmluZWQsIHBhbmVpcm8sIGphbWJvKSB7XG4gICAgICBQb2x5bWVyKHtcbiAgICAgICAgaXM6ICdjaGVja291dC1wYWdlJyxcblxuICAgICAgICBwcm9wZXJ0aWVzOiB7ICAgICAgICAgICAgICBcbiAgICAgICAgICB1c2VyOiBPYmplY3QsXG4gICAgICAgICAgY2FydDogT2JqZWN0LFxuICAgICAgICAgIGRheXM6IHtcbiAgICAgICAgICAgIHR5cGU6IEFycmF5LFxuICAgICAgICAgICAgbm90aWZ5OiB0cnVlXG4gICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIHJlYWR5OiBmdW5jdGlvbigpIHsgICAgICAgICAgXG4gICAgICAgICAgaWYgKHRoaXMuY2FydC5pdGVtcy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgIHRoaXMuJC5pcm9uTG9jYXRpb24ucGF0aCA9ICcvbG9qYS9jYXRlZ29yaWEvcGV0c2hvcCc7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHZhciB3ZWVrRGF5cyA9IFsnRG9tJywgJ1NlZycsICdUZXInLCAnUXVhJywgJ1F1aScsICdTZXgnLCAnU8OhYiddO1xuICAgICAgICAgICAgdmFyIGQgPSBuZXcgRGF0ZSgpO1xuICAgICAgICAgICAgdGhpcy5kYXlzID0gW107XG5cbiAgICAgICAgICAgIGlmIChkLmdldERheSgpIDw9IDEpIHtcbiAgICAgICAgICAgICAgdmFyIGRpZmYgPSAzIC0gZC5nZXREYXkoKTtcbiAgICAgICAgICAgICAgZC5zZXREYXRlKGQuZ2V0RGF0ZSgpICsgZGlmZik7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKGQuZ2V0RGF5KCkgPD0gNCkge1xuICAgICAgICAgICAgICB2YXIgZGlmZiA9IDYgLSBkLmdldERheSgpO1xuICAgICAgICAgICAgICBkLnNldERhdGUoZC5nZXREYXRlKCkgKyBkaWZmKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIHZhciBkaWZmID0gNyAtIGQuZ2V0RGF5KCkgKyAzO1xuICAgICAgICAgICAgICBkLnNldERhdGUoZC5nZXREYXRlKCkgKyBkaWZmKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCA0OyArK2kpIHtcbiAgICAgICAgICAgICAgdGhpcy5wdXNoKCdkYXlzJywge1xuICAgICAgICAgICAgICAgIGxhYmVsOiB3ZWVrRGF5c1tkLmdldERheSgpXSArICcgLSAnICsgZC5nZXREYXRlKCkgKyAnLycgKyAoZC5nZXRNb250aCgpICsgMSksXG4gICAgICAgICAgICAgICAgdmFsdWU6IGQuZ2V0RnVsbFllYXIoKSArICctJyArIChkLmdldE1vbnRoKCkrMSkgKyAnLScgKyBkLmdldERhdGUoKVxuICAgICAgICAgICAgICB9KTsgICAgICAgICAgICBcblxuICAgICAgICAgICAgICBpZiAoZC5nZXREYXkoKSA9PT0gMykge1xuICAgICAgICAgICAgICAgIGQuc2V0RGF0ZShkLmdldERhdGUoKSArIDMpO1xuICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGQuc2V0RGF0ZShkLmdldERhdGUoKSArIDQpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSAgICAgICAgICBcbiAgICAgICAgfSxcblxuICAgICAgICBvbkNoZWNrb3V0Rm9ybVByZVN1Ym1pdDogZnVuY3Rpb24oZSkge1xuICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcblxuICAgICAgICAgIHZhciB0b2FzdCA9IHRoaXMuJC50b2FzdDtcbiAgICAgICAgICB2YXIgbW9kYWwgPSBwYW5laXJvLm1vZGFscy5tZXNzYWdlO1xuICAgICAgICAgIHZhciBmb3JtRGF0YSA9IHRoaXMuJC5jaGVja291dEZvcm0uc2VyaWFsaXplKCk7ICAgICAgICAgICAgICAgICAgICBcblxuICAgICAgICAgIHRvYXN0Lm9wZW4oKTtcblxuICAgICAgICAgIHZhciBkZWxpdmVyeURhdGV0aW1lID0gdGhpcy4kLmRhdGVNZW51LnNlbGVjdGVkSXRlbS5nZXRBdHRyaWJ1dGUoJ2RhdGEtdmFsdWUnKSArICcgJyArXG4gICAgICAgICAgICB0aGlzLiQudGltZU1lbnUuc2VsZWN0ZWRJdGVtLmdldEF0dHJpYnV0ZSgnZGF0YS12YWx1ZScpOyAgICBcbiAgICAgICAgICBwYW5laXJvLmFwaS5wdXJjaGFzZS5jaGVja291dCh7XG4gICAgICAgICAgICBwaG9uZTogdGhpcy51c2VyLnBob25lLFxuICAgICAgICAgICAgYWRkcjogZm9ybURhdGEuYWRkcixcbiAgICAgICAgICAgIGRlbGl2ZXJ5RGF0ZTogZGVsaXZlcnlEYXRldGltZVxuICAgICAgICAgIH0pLnRoZW4ocmVzcG9uc2UgPT4ge1xuICAgICAgICAgICAgdG9hc3QuY2xvc2UoKTtcblxuICAgICAgICAgICAgbW9kYWwubWVzc2FnZSA9ICdTZXUgcGVkaWRvIGZvaSByZWdpc3RyYWRvIGNvbSBzdWNlc3NvLCBlIHNlcsOhIGVudHJlZ3VlIG5hIGRhdGEgZSBob3LDoXJpbyBhZ2VuZGFkb3MuXFxuJyArIFxuICAgICAgICAgICAgICAnQ2FzbyBzZWphIG5lY2Vzc8OhcmlvLCBlbnRyYXJlbW9zIGVtIGNvbnRhdG8uXFxuJyArXG4gICAgICAgICAgICAgICdBZ3JhZGVjZW1vcyBhIHByZWZlcsOqbmNpYSBlIGF0w6kgYSBwcsOzeGltYSEnOyAgXG4gICAgICAgICAgICBtb2RhbC50aXRsZSA9ICdQZWRpZG8gcmVnaXN0cmFkbyBjb20gc3VjZXNzby4nO1xuXG4gICAgICAgICAgICBtb2RhbC5vcGVuKCk7XG5cbiAgICAgICAgICAgIHRoaXMuc2V0KCdjYXJ0Lml0ZW1zJywgW10pO1xuICAgICAgICAgICAgdGhpcy5zZXQoJ2NhcnQudG90YWwnLCAwKTsgICAgICAgICAgICBcblxuICAgICAgICAgICAgdGhpcy4kLmlyb25Mb2NhdGlvbi5zZXQoJ3BhdGgnLCAnL2xvamEvY2F0ZWdvcmlhL3BldHNob3AnKTsgICAgICAgICAgICBcbiAgICAgICAgICB9KS5jYXRjaChyZXNwb25zZSA9PiBjb25zb2xlLmxvZyhyZXNwb25zZSkpOyAgICAgICAgICBcbiAgICAgICAgfSxcblxuICAgICAgICBvbkNoZWNrb3V0Rm9ybUJ1dHRvblRhcDogZnVuY3Rpb24oKSB7ICAgICAgICAgIFxuICAgICAgICAgIGlmICghdGhpcy4kLmNoZWNrb3V0Rm9ybS52YWxpZGF0ZSgpKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgfSBcblxuICAgICAgICAgIHRoaXMuJC5jaGVja291dEZvcm0uc3VibWl0KCk7ICAgICAgICAgIFxuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9KSh3aW5kb3csIGRvY3VtZW50LCB1bmRlZmluZWQsIHBhbmVpcm8sIGphbWJvKTsiXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=
