<link rel="import" href="../../bower_components/polymer/polymer.html"><link rel="import" href="../../bower_components/app-route/app-route.html"><link rel="import" href="../../bower_components/paper-card/paper-card.html"><link rel="import" href="../../bower_components/paper-icon-button/paper-icon-button.html"><link rel="import" href="../../bower_components/paper-input/paper-input.html"><link rel="import" href="../../bower_components/paper-spinner/paper-spinner-lite.html"><link rel="import" href="../../bower_components/paper-styles/typography.html"><link rel="import" href="../../bower_components/paper-progress/paper-progress.html"><link rel="import" href="../../bower_components/paper-toast/paper-toast.html"><link rel="import" href="../../bower_components/iron-icon/iron-icon.html"><link rel="import" href="../elements/product-grid.html"><link rel="import" href="../paneiro-theme.html"><dom-module id="category-page"><template><style>:host{display:block}.main-content{padding:48px 8px}#loadMoreWrapper{text-align:center}#loadMoreButton{@apply(--paper-font-button);background:var(--primary-color);color:#fff;margin:16px}paper-spinner-lite{height:50px;width:50px;display:block;margin:0 auto;--paper-spinner-color:var(--primary-color);--paper-spinner-stroke-width:4px}paper-spinner-lite:not([active]){display:none}.page-title{@apply(--paper-font-display1);margin:0 8px 16px 0}@media screen and (max-width:780px){.page-title{@apply(--paper-font-headline)}}</style><app-route route="{{route}}" pattern="/:category" data="{{routeData}}"></app-route><main class="container main-content"><div class="page-title">{{categoryName}}</div><paper-spinner-lite id="loadingSpinner" active="{{firstLoad}}"></paper-spinner-lite><product-grid products="{{products}}" cart="{{cart}}"></product-grid><template is="dom-if" if="{{hasNext}}"><div id="loadMoreWrapper"><paper-button id="loadMoreButton" on-tap="onLoadMoreTap">Ver mais produtos</paper-button></div></template></main></template><script type="text/javascript">"use strict";!function(t,e,o,a,r){for(var s={},i=a.config.categories,d=0,n=i.length;d<n;++d)s[i[d].path]=i[d];Polymer({is:"category-page",properties:{cart:Object,categoryName:String,firstLoad:{type:Array,notify:!0},hasNext:{type:Boolean,value:!1},products:{type:Array,notify:!0},page:Number,route:Object,selectedCategory:{type:String,notify:!0}},observers:["_routeCategoryChanged(routeData.category)"],_routeCategoryChanged:function(t){this.firstLoad?this.products=[]:(a.sharedElements.loadingProgress.classList.add("transiting"),a.sharedElements.loadingProgress.value=85),t=t||"petshop";var e=s[t];this.hasNext=!1,this.selectedCategory=t,this.page=1,this.categoryName=e.name,this._loadCategoryProducts(e.id,this.page)},_loadCategoryProducts:function(e,r){var s=this;a.api.product.get({category:e,page:r}).then(function(e){1===r?(s.products=e.data,s.products.forEach(function(t){t.qty=1}),t.scrollTo(0,0)):e.data.forEach(function(t){t.qty=1,s.push("products",t)}),s.hasNext=e.paging!==o&&e.paging.next!==o,s.firstLoad||(a.sharedElements.loadingProgress.value=100,a.sharedElements.loadingProgress.classList.remove("transiting"),setTimeout(function(){a.sharedElements.loadingProgress.value=0},300)),s.firstLoad=!1})},onIncQtyTap:function(t){t.model.product.qty<9&&t.model.set("product.qty",t.model.product.qty+1)},onDecQtyTap:function(t){t.model.product.qty>0&&t.model.set("product.qty",t.model.product.qty-1)},onAddToCartTap:function(t){var e=this,o=t.model.product,s=o.qty;o.price;a.api.cart.addProduct({id:o.id,qty:o.qty}).then(function(t){e.$.addedToCartToast.open();var a=e.cart.items.findIndex(function(t,e,a){return t.id===o.id});if(a>-1)e.set("cart.items."+a+".qty",e.cart.items[a].qty+s);else{var i=r.deepExtend({},o);i.qty=s,e.push("cart.items",i)}e.set("cart.total",e.cart.total+s*o.price)}).catch(function(t){return console.log(t)}),t.model.set("product.qty",0)},onLoadMoreTap:function(){this.page++;var t=s[this.selectedCategory];this._loadCategoryProducts(t.id,this.page),this.firstLoad||(a.sharedElements.loadingProgress.classList.add("transiting"),a.sharedElements.loadingProgress.value=85)}})}(window,document,void 0,paneiro,jambo);</script></dom-module>