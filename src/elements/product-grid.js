'use strict';

(function (window, document, undefined, paneiro, jambo) {
  Polymer({
    is: 'product-grid',

    properties: {
      cart: Object,
      products: {
        type: Array,
        notify: true
      },
      page: Number
    },

    currencyFormat: function currencyFormat(val) {
      return paneiro.commons.currencyFormat(val);
    },

    onIncQtyTap: function onIncQtyTap(e) {
      if (e.model.product.qty < 9) {
        e.model.set('product.qty', e.model.product.qty + 1);
      }
    },

    onDecQtyTap: function onDecQtyTap(e) {
      if (e.model.product.qty > 0) {
        e.model.set('product.qty', e.model.product.qty - 1);
      }
    },

    onAddToCartTap: function onAddToCartTap(e) {
      var _this = this;

      var product = e.model.product;

      var qty = product.qty;
      var price = product.price;

      paneiro.api.cart.addProduct({
        id: product.id,
        qty: product.qty
      }).then(function (response) {
        _this.$.addedToCartToast.open();

        var idx = _this.cart.items.findIndex(function (element, index, array) {
          return element.id === product.id;
        });

        if (idx > -1) {
          _this.set('cart.items.' + idx + '.qty', _this.cart.items[idx].qty + qty);
        } else {
          var p = jambo.deepExtend({}, product);
          p.qty = qty;

          _this.push('cart.items', p);
        }

        _this.set('cart.total', _this.cart.total + qty * product.price);
      }).catch(function (err) {
        return console.log(err);
      });

      e.model.set('product.qty', 1);
    }
  });
})(window, document, undefined, paneiro, jambo);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImVsZW1lbnRzL3Byb2R1Y3QtZ3JpZC5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUFBLENBQUMsVUFBUyxNQUFULEVBQWlCLFFBQWpCLEVBQTJCLFNBQTNCLEVBQXNDLE9BQXRDLEVBQStDLEtBQS9DLEVBQXNEO0FBQ2pELFVBQVE7QUFDTixRQUFJLGNBREU7O0FBR04sZ0JBQVk7QUFDVixZQUFNLE1BREk7QUFFVixnQkFBVTtBQUNSLGNBQU0sS0FERTtBQUVSLGdCQUFRO0FBRkEsT0FGQTtBQU1WLFlBQU07QUFOSSxLQUhOOztBQVlOLG9CQUFnQix3QkFBUyxHQUFULEVBQWM7QUFDNUIsYUFBTyxRQUFRLE9BQVIsQ0FBZ0IsY0FBaEIsQ0FBK0IsR0FBL0IsQ0FBUDtBQUNELEtBZEs7O0FBZ0JOLGlCQUFhLHFCQUFTLENBQVQsRUFBWTtBQUN2QixVQUFJLEVBQUUsS0FBRixDQUFRLE9BQVIsQ0FBZ0IsR0FBaEIsR0FBc0IsQ0FBMUIsRUFBNkI7QUFDM0IsVUFBRSxLQUFGLENBQVEsR0FBUixDQUFZLGFBQVosRUFBMkIsRUFBRSxLQUFGLENBQVEsT0FBUixDQUFnQixHQUFoQixHQUFzQixDQUFqRDtBQUNEO0FBQ0YsS0FwQks7O0FBc0JOLGlCQUFhLHFCQUFTLENBQVQsRUFBWTtBQUN2QixVQUFJLEVBQUUsS0FBRixDQUFRLE9BQVIsQ0FBZ0IsR0FBaEIsR0FBc0IsQ0FBMUIsRUFBNkI7QUFDM0IsVUFBRSxLQUFGLENBQVEsR0FBUixDQUFZLGFBQVosRUFBMkIsRUFBRSxLQUFGLENBQVEsT0FBUixDQUFnQixHQUFoQixHQUFzQixDQUFqRDtBQUNEO0FBQ0YsS0ExQks7O0FBNEJOLG9CQUFnQix3QkFBUyxDQUFULEVBQVk7QUFBQTs7QUFDMUIsVUFBSSxVQUFVLEVBQUUsS0FBRixDQUFRLE9BQXRCOztBQUVBLFVBQUksTUFBTSxRQUFRLEdBQWxCO0FBQ0EsVUFBSSxRQUFRLFFBQVEsS0FBcEI7O0FBRUEsY0FBUSxHQUFSLENBQVksSUFBWixDQUFpQixVQUFqQixDQUE0QjtBQUMxQixZQUFJLFFBQVEsRUFEYztBQUUxQixhQUFLLFFBQVE7QUFGYSxPQUE1QixFQUdHLElBSEgsQ0FHUSxvQkFBWTtBQUNsQixjQUFLLENBQUwsQ0FBTyxnQkFBUCxDQUF3QixJQUF4Qjs7QUFFQSxZQUFJLE1BQU0sTUFBSyxJQUFMLENBQVUsS0FBVixDQUFnQixTQUFoQixDQUEwQixVQUFDLE9BQUQsRUFBVSxLQUFWLEVBQWlCLEtBQWpCLEVBQTJCO0FBQzdELGlCQUFPLFFBQVEsRUFBUixLQUFlLFFBQVEsRUFBOUI7QUFDRCxTQUZTLENBQVY7O0FBSUEsWUFBSSxNQUFNLENBQUMsQ0FBWCxFQUFjO0FBQ1osZ0JBQUssR0FBTCxDQUFTLGdCQUFnQixHQUFoQixHQUFzQixNQUEvQixFQUF1QyxNQUFLLElBQUwsQ0FBVSxLQUFWLENBQWdCLEdBQWhCLEVBQXFCLEdBQXJCLEdBQTJCLEdBQWxFO0FBQ0QsU0FGRCxNQUVPO0FBQ0wsY0FBSSxJQUFJLE1BQU0sVUFBTixDQUFpQixFQUFqQixFQUFxQixPQUFyQixDQUFSO0FBQ0EsWUFBRSxHQUFGLEdBQVEsR0FBUjs7QUFFQSxnQkFBSyxJQUFMLENBQVUsWUFBVixFQUF3QixDQUF4QjtBQUNEOztBQUVELGNBQUssR0FBTCxDQUFTLFlBQVQsRUFBdUIsTUFBSyxJQUFMLENBQVUsS0FBVixHQUFrQixNQUFJLFFBQVEsS0FBckQ7QUFDRCxPQXBCRCxFQW9CRyxLQXBCSCxDQW9CUztBQUFBLGVBQU8sUUFBUSxHQUFSLENBQVksR0FBWixDQUFQO0FBQUEsT0FwQlQ7O0FBc0JBLFFBQUUsS0FBRixDQUFRLEdBQVIsQ0FBWSxhQUFaLEVBQTJCLENBQTNCO0FBQ0Q7QUF6REssR0FBUjtBQTJERCxDQTVETCxFQTRETyxNQTVEUCxFQTREZSxRQTVEZixFQTREeUIsU0E1RHpCLEVBNERvQyxPQTVEcEMsRUE0RDZDLEtBNUQ3QyIsImZpbGUiOiJlbGVtZW50cy9wcm9kdWN0LWdyaWQuanMiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24od2luZG93LCBkb2N1bWVudCwgdW5kZWZpbmVkLCBwYW5laXJvLCBqYW1ibykgeyAgICAgICAgICAgIFxuICAgICAgUG9seW1lcih7XG4gICAgICAgIGlzOiAncHJvZHVjdC1ncmlkJyxcblxuICAgICAgICBwcm9wZXJ0aWVzOiB7XG4gICAgICAgICAgY2FydDogT2JqZWN0LCAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgIHByb2R1Y3RzOiB7XG4gICAgICAgICAgICB0eXBlOiBBcnJheSxcbiAgICAgICAgICAgIG5vdGlmeTogdHJ1ZVxuICAgICAgICAgIH0sXG4gICAgICAgICAgcGFnZTogTnVtYmVyICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgfSwgICAgICAgICBcblxuICAgICAgICBjdXJyZW5jeUZvcm1hdDogZnVuY3Rpb24odmFsKSB7XG4gICAgICAgICAgcmV0dXJuIHBhbmVpcm8uY29tbW9ucy5jdXJyZW5jeUZvcm1hdCh2YWwpO1xuICAgICAgICB9LCAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcblxuICAgICAgICBvbkluY1F0eVRhcDogZnVuY3Rpb24oZSkgeyAgICAgICAgICBcbiAgICAgICAgICBpZiAoZS5tb2RlbC5wcm9kdWN0LnF0eSA8IDkpIHtcbiAgICAgICAgICAgIGUubW9kZWwuc2V0KCdwcm9kdWN0LnF0eScsIGUubW9kZWwucHJvZHVjdC5xdHkgKyAxKTtcbiAgICAgICAgICB9ICAgICAgICAgIFxuICAgICAgICB9LFxuXG4gICAgICAgIG9uRGVjUXR5VGFwOiBmdW5jdGlvbihlKSB7ICAgICAgICAgIFxuICAgICAgICAgIGlmIChlLm1vZGVsLnByb2R1Y3QucXR5ID4gMCkge1xuICAgICAgICAgICAgZS5tb2RlbC5zZXQoJ3Byb2R1Y3QucXR5JywgZS5tb2RlbC5wcm9kdWN0LnF0eSAtIDEpO1xuICAgICAgICAgIH0gICAgICAgICAgXG4gICAgICAgIH0sXG5cbiAgICAgICAgb25BZGRUb0NhcnRUYXA6IGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgICB2YXIgcHJvZHVjdCA9IGUubW9kZWwucHJvZHVjdDtcblxuICAgICAgICAgIHZhciBxdHkgPSBwcm9kdWN0LnF0eTtcbiAgICAgICAgICB2YXIgcHJpY2UgPSBwcm9kdWN0LnByaWNlO1xuICAgICAgICAgIFxuICAgICAgICAgIHBhbmVpcm8uYXBpLmNhcnQuYWRkUHJvZHVjdCh7XG4gICAgICAgICAgICBpZDogcHJvZHVjdC5pZCxcbiAgICAgICAgICAgIHF0eTogcHJvZHVjdC5xdHlcbiAgICAgICAgICB9KS50aGVuKHJlc3BvbnNlID0+IHsgICAgICAgICAgICBcbiAgICAgICAgICAgIHRoaXMuJC5hZGRlZFRvQ2FydFRvYXN0Lm9wZW4oKTtcblxuICAgICAgICAgICAgdmFyIGlkeCA9IHRoaXMuY2FydC5pdGVtcy5maW5kSW5kZXgoKGVsZW1lbnQsIGluZGV4LCBhcnJheSkgPT4ge1xuICAgICAgICAgICAgICByZXR1cm4gZWxlbWVudC5pZCA9PT0gcHJvZHVjdC5pZDtcbiAgICAgICAgICAgIH0pOyAgICAgICAgICAgIFxuXG4gICAgICAgICAgICBpZiAoaWR4ID4gLTEpIHtcbiAgICAgICAgICAgICAgdGhpcy5zZXQoJ2NhcnQuaXRlbXMuJyArIGlkeCArICcucXR5JywgdGhpcy5jYXJ0Lml0ZW1zW2lkeF0ucXR5ICsgcXR5KTsgICAgICAgICAgICAgIFxuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgdmFyIHAgPSBqYW1iby5kZWVwRXh0ZW5kKHt9LCBwcm9kdWN0KTtcbiAgICAgICAgICAgICAgcC5xdHkgPSBxdHk7XG5cbiAgICAgICAgICAgICAgdGhpcy5wdXNoKCdjYXJ0Lml0ZW1zJywgcCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHRoaXMuc2V0KCdjYXJ0LnRvdGFsJywgdGhpcy5jYXJ0LnRvdGFsICsgcXR5KnByb2R1Y3QucHJpY2UpO1xuICAgICAgICAgIH0pLmNhdGNoKGVyciA9PiBjb25zb2xlLmxvZyhlcnIpKTtcblxuICAgICAgICAgIGUubW9kZWwuc2V0KCdwcm9kdWN0LnF0eScsIDEpO1xuICAgICAgICB9ICAgICAgICBcbiAgICAgIH0pO1xuICAgIH0pKHdpbmRvdywgZG9jdW1lbnQsIHVuZGVmaW5lZCwgcGFuZWlybywgamFtYm8pOyJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==
