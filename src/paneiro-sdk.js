'use strict';

(function (window, document, undefined, jambo) {
  'use strict';

  var PaneiroConfig = {
    api: {
      url: 'http://api.paneirovirtual.com/v1',
      limit: 40
    },

    categories: [{
      id: 1,
      name: 'Petshop',
      path: 'petshop'
    }, {
      id: 2,
      name: 'Limpeza',
      path: 'limpeza'
    }, {
      id: 3,
      name: 'Mercearia',
      path: 'mercearia'
    }, {
      id: 4,
      name: 'Bebidas',
      path: 'bebidas'
    }, {
      id: 5,
      name: 'Frios e Laticínios',
      path: 'frios-e-laticinios'
    }, {
      id: 6,
      name: 'Higiene e Beleza',
      path: 'higiene-e-beleza'
    }, {
      id: 7,
      name: 'Utilidades Domésticas',
      path: 'utilidades-domesticas'
    }, {
      id: 9,
      name: 'Padaria',
      path: 'padaria'
    }, {
      id: 10,
      name: 'Congelados',
      path: 'congelados'
    }, {
      id: 11,
      name: 'Hortifruti',
      path: 'hortifruti'
    }],

    shippingPrice: 990
  };

  var PaneiroApi = {
    cart: {
      addProduct: function addProduct(product) {
        var reqObj = {
          items: [{
            productId: product.id,
            qty: product.qty
          }]
        };

        return jambo.ajax({
          url: PaneiroConfig.api.url + '/cart',
          method: 'POST',
          data: {
            data: JSON.stringify(reqObj),
            userToken: paneiro.userToken
          }
        });
      },

      removeProduct: function removeProduct(product) {
        var reqObj = { items: [{ productId: product.id }] };
        if (product.qty) {
          reqObj.items[0].qty = product.qty;
        }

        return jambo.ajax({
          url: PaneiroConfig.api.url + '/cart',
          method: 'DELETE',
          data: {
            data: JSON.stringify(reqObj),
            userToken: paneiro.userToken
          }
        });
      },

      get: function get() {
        return jambo.ajax({
          url: PaneiroConfig.api.url + '/cart',
          method: 'GET',
          data: {
            userToken: paneiro.userToken
          }
        });
      }
    },

    product: {
      search: function search(options) {
        var paramData = {};

        if (options.query) {
          paramData.q = options.query;
        }

        if (options.limit) {
          paramData.limit = options.limit;
        } else {
          paramData.limit = PaneiroConfig.api.limit;
        }

        if (options.page) {
          paramData.page = options.page;
        }

        return new Promise(function (resolve, reject) {
          jambo.ajax({
            url: PaneiroConfig.api.url + '/search/products',
            method: 'GET',
            data: paramData
          }).then(function (response) {
            return resolve({
              data: response.data,
              paging: response.paging
            });
          }).catch(function (response) {
            if (response.status === 'ZERO_RESULTS') {
              resolve({
                data: []
              });
            } else {
              reject(response);
            }
          });
        });
      },

      get: function get(options) {
        var paramData = {};
        if (options.category) {
          paramData.category = options.category;
        }

        if (options.limit) {
          paramData.limit = options.limit;
        } else {
          paramData.limit = PaneiroConfig.api.limit;
        }

        if (options.page) {
          paramData.page = options.page;
        }

        return jambo.ajax({
          url: PaneiroConfig.api.url + '/products',
          method: 'GET',
          data: paramData
        });
      }
    },

    user: {
      getData: function getData(options) {
        return new Promise(function (resolve, reject) {
          jambo.ajax({
            url: PaneiroConfig.api.url + '/auth',
            data: { userToken: options.userToken }
          }).then(function (response) {
            resolve(response.data);
          }).catch(function (response) {
            if (response.status === 'ZERO_RESULTS') {
              resolve();
            }

            reject(response);
          });
        });
      },

      register: function register(userData) {
        return jambo.ajax({
          url: PaneiroConfig.api.url + '/users',
          method: 'POST',
          data: { data: JSON.stringify(userData) }
        });
      }
    },

    purchase: {
      checkout: function checkout(options) {
        return jambo.ajax({
          url: PaneiroConfig.api.url + '/purchases',
          method: 'POST',
          data: {
            data: JSON.stringify(options),
            userToken: paneiro.userToken
          }
        });
      }
    }
  };

  var PaneiroCommons = {
    currencyFormat: function currencyFormat(val) {
      var intPart = Math.floor(val / 100);
      var decimal = val % 100;

      var cents = decimal > 9 ? decimal + '' : '0' + decimal;

      return 'R$ ' + intPart + ',' + cents;
    }
  };

  window.paneiro = window.paneiro || {};

  window.paneiro.api = PaneiroApi;
  window.paneiro.config = PaneiroConfig;
  window.paneiro.commons = PaneiroCommons;

  window.paneiro.userToken = jambo.getCookie('userToken');
})(window, document, undefined, jambo);
//# sourceMappingURL=data:application/json;base64,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QUFlLE9BQWYsQ0FERjtBQUVKLHVCQUFXLFFBQVE7QUFGZjtBQUhVLFNBQVgsQ0FBUDtBQVFEO0FBVk87QUE1SUssR0FBakI7O0FBMEpBLE1BQUksaUJBQWlCO0FBQ25CLG9CQUFnQix3QkFBVSxHQUFWLEVBQWU7QUFDN0IsVUFBSSxVQUFVLEtBQUssS0FBTCxDQUFXLE1BQU0sR0FBakIsQ0FBZDtBQUNBLFVBQUksVUFBVSxNQUFNLEdBQXBCOztBQUVBLFVBQUksUUFBUyxVQUFVLENBQVgsR0FDVixVQUFVLEVBREEsR0FFVixNQUFNLE9BRlI7O0FBSUEsYUFBTyxRQUFRLE9BQVIsR0FBa0IsR0FBbEIsR0FBd0IsS0FBL0I7QUFDRDtBQVZrQixHQUFyQjs7QUFhQSxTQUFPLE9BQVAsR0FBaUIsT0FBTyxPQUFQLElBQWtCLEVBQW5DOztBQUVBLFNBQU8sT0FBUCxDQUFlLEdBQWYsR0FBcUIsVUFBckI7QUFDQSxTQUFPLE9BQVAsQ0FBZSxNQUFmLEdBQXdCLGFBQXhCO0FBQ0EsU0FBTyxPQUFQLENBQWUsT0FBZixHQUF5QixjQUF6Qjs7QUFFQSxTQUFPLE9BQVAsQ0FBZSxTQUFmLEdBQTJCLE1BQU0sU0FBTixDQUFnQixXQUFoQixDQUEzQjtBQUNELENBL09ELEVBK09HLE1BL09ILEVBK09XLFFBL09YLEVBK09xQixTQS9PckIsRUErT2dDLEtBL09oQyIsImZpbGUiOiJwYW5laXJvLXNkay5qcyIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbih3aW5kb3csIGRvY3VtZW50LCB1bmRlZmluZWQsIGphbWJvKSB7XG4gICd1c2Ugc3RyaWN0JztcblxuICB2YXIgUGFuZWlyb0NvbmZpZyA9IHtcbiAgICBhcGk6IHtcbiAgICAgIHVybDogJ2h0dHA6Ly9hcGkucGFuZWlyb3ZpcnR1YWwuY29tL3YxJyxcbiAgICAgIGxpbWl0OiA0MFxuICAgIH0sXG5cbiAgICBjYXRlZ29yaWVzOiBbXG4gICAgICB7XG4gICAgICAgIGlkOiAxLFxuICAgICAgICBuYW1lOiAnUGV0c2hvcCcsXG4gICAgICAgIHBhdGg6ICdwZXRzaG9wJ1xuICAgICAgfSxcbiAgICAgIHtcbiAgICAgICAgaWQ6IDIsXG4gICAgICAgIG5hbWU6ICdMaW1wZXphJyxcbiAgICAgICAgcGF0aDogJ2xpbXBlemEnXG4gICAgICB9LFxuICAgICAge1xuICAgICAgICBpZDogMyxcbiAgICAgICAgbmFtZTogJ01lcmNlYXJpYScsXG4gICAgICAgIHBhdGg6ICdtZXJjZWFyaWEnXG4gICAgICB9LFxuICAgICAge1xuICAgICAgICBpZDogNCxcbiAgICAgICAgbmFtZTogJ0JlYmlkYXMnLFxuICAgICAgICBwYXRoOiAnYmViaWRhcydcbiAgICAgIH0sXG4gICAgICB7XG4gICAgICAgIGlkOiA1LFxuICAgICAgICBuYW1lOiAnRnJpb3MgZSBMYXRpY8OtbmlvcycsXG4gICAgICAgIHBhdGg6ICdmcmlvcy1lLWxhdGljaW5pb3MnXG4gICAgICB9LFxuICAgICAge1xuICAgICAgICBpZDogNixcbiAgICAgICAgbmFtZTogJ0hpZ2llbmUgZSBCZWxlemEnLFxuICAgICAgICBwYXRoOiAnaGlnaWVuZS1lLWJlbGV6YSdcbiAgICAgIH0sXG4gICAgICB7XG4gICAgICAgIGlkOiA3LFxuICAgICAgICBuYW1lOiAnVXRpbGlkYWRlcyBEb23DqXN0aWNhcycsXG4gICAgICAgIHBhdGg6ICd1dGlsaWRhZGVzLWRvbWVzdGljYXMnXG4gICAgICB9LCAgICAgIFxuICAgICAge1xuICAgICAgICBpZDogOSxcbiAgICAgICAgbmFtZTogJ1BhZGFyaWEnLFxuICAgICAgICBwYXRoOiAncGFkYXJpYSdcbiAgICAgIH0sXG4gICAgICB7XG4gICAgICAgIGlkOiAxMCxcbiAgICAgICAgbmFtZTogJ0NvbmdlbGFkb3MnLFxuICAgICAgICBwYXRoOiAnY29uZ2VsYWRvcydcbiAgICAgIH0sXG4gICAgICB7XG4gICAgICAgIGlkOiAxMSxcbiAgICAgICAgbmFtZTogJ0hvcnRpZnJ1dGknLFxuICAgICAgICBwYXRoOiAnaG9ydGlmcnV0aSdcbiAgICAgIH0gICAgICBcbiAgICBdLFxuXG4gICAgc2hpcHBpbmdQcmljZTogOTkwXG4gIH07XG5cbiAgdmFyIFBhbmVpcm9BcGkgPSB7XG4gICAgY2FydDoge1xuICAgICAgYWRkUHJvZHVjdDogZnVuY3Rpb24ocHJvZHVjdCkge1xuICAgICAgICB2YXIgcmVxT2JqID0ge1xuICAgICAgICAgIGl0ZW1zOiBbXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgIHByb2R1Y3RJZDogcHJvZHVjdC5pZCxcbiAgICAgICAgICAgICAgcXR5OiBwcm9kdWN0LnF0eVxuICAgICAgICAgICAgfVxuICAgICAgICAgIF1cbiAgICAgICAgfTtcblxuICAgICAgICByZXR1cm4gamFtYm8uYWpheCh7XG4gICAgICAgICAgdXJsOiBQYW5laXJvQ29uZmlnLmFwaS51cmwgKyAnL2NhcnQnLFxuICAgICAgICAgIG1ldGhvZDogJ1BPU1QnLFxuICAgICAgICAgIGRhdGE6IHsgXG4gICAgICAgICAgICBkYXRhOiBKU09OLnN0cmluZ2lmeShyZXFPYmopLFxuICAgICAgICAgICAgdXNlclRva2VuOiBwYW5laXJvLnVzZXJUb2tlbiBcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgfSxcblxuICAgICAgcmVtb3ZlUHJvZHVjdDogZnVuY3Rpb24ocHJvZHVjdCkge1xuICAgICAgICB2YXIgcmVxT2JqID0ge2l0ZW1zOiBbe3Byb2R1Y3RJZDogcHJvZHVjdC5pZH1dfTtcbiAgICAgICAgaWYgKHByb2R1Y3QucXR5KSB7XG4gICAgICAgICAgcmVxT2JqLml0ZW1zWzBdLnF0eSA9IHByb2R1Y3QucXR5O1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIGphbWJvLmFqYXgoe1xuICAgICAgICAgIHVybDogUGFuZWlyb0NvbmZpZy5hcGkudXJsICsgJy9jYXJ0JyxcbiAgICAgICAgICBtZXRob2Q6ICdERUxFVEUnLFxuICAgICAgICAgIGRhdGE6IHsgXG4gICAgICAgICAgICBkYXRhOiBKU09OLnN0cmluZ2lmeShyZXFPYmopLFxuICAgICAgICAgICAgdXNlclRva2VuOiBwYW5laXJvLnVzZXJUb2tlbiBcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgfSxcblxuICAgICAgZ2V0OiBmdW5jdGlvbigpIHtcbiAgICAgICAgcmV0dXJuIGphbWJvLmFqYXgoe1xuICAgICAgICAgIHVybDogUGFuZWlyb0NvbmZpZy5hcGkudXJsICsgJy9jYXJ0JyxcbiAgICAgICAgICBtZXRob2Q6ICdHRVQnLFxuICAgICAgICAgIGRhdGE6IHsgICAgICAgICAgICAgXG4gICAgICAgICAgICB1c2VyVG9rZW46IHBhbmVpcm8udXNlclRva2VuIFxuICAgICAgICAgIH1cbiAgICAgICAgfSk7IFxuICAgICAgfVxuICAgIH0sXG5cbiAgICBwcm9kdWN0OiB7XG4gICAgICBzZWFyY2g6IGZ1bmN0aW9uKG9wdGlvbnMpIHtcbiAgICAgICAgdmFyIHBhcmFtRGF0YSA9IHt9O1xuXG4gICAgICAgIGlmIChvcHRpb25zLnF1ZXJ5KSB7XG4gICAgICAgICAgcGFyYW1EYXRhLnEgPSBvcHRpb25zLnF1ZXJ5O1xuICAgICAgICB9ICAgICAgICBcblxuICAgICAgICBpZiAob3B0aW9ucy5saW1pdCkge1xuICAgICAgICAgIHBhcmFtRGF0YS5saW1pdCA9IG9wdGlvbnMubGltaXQ7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgcGFyYW1EYXRhLmxpbWl0ID0gUGFuZWlyb0NvbmZpZy5hcGkubGltaXRcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChvcHRpb25zLnBhZ2UpIHtcbiAgICAgICAgICBwYXJhbURhdGEucGFnZSA9IG9wdGlvbnMucGFnZTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICAgICAgamFtYm8uYWpheCh7XG4gICAgICAgICAgICB1cmw6IFBhbmVpcm9Db25maWcuYXBpLnVybCArICcvc2VhcmNoL3Byb2R1Y3RzJyxcbiAgICAgICAgICAgIG1ldGhvZDogJ0dFVCcsXG4gICAgICAgICAgICBkYXRhOiBwYXJhbURhdGFcbiAgICAgICAgICB9KS50aGVuKHJlc3BvbnNlID0+IFxuICAgICAgICAgICAgcmVzb2x2ZSh7XG4gICAgICAgICAgICAgIGRhdGE6IHJlc3BvbnNlLmRhdGEsXG4gICAgICAgICAgICAgIHBhZ2luZzogcmVzcG9uc2UucGFnaW5nXG4gICAgICAgICAgICB9KVxuICAgICAgICAgICkuY2F0Y2gocmVzcG9uc2UgPT4ge1xuICAgICAgICAgICAgaWYgKHJlc3BvbnNlLnN0YXR1cyA9PT0gJ1pFUk9fUkVTVUxUUycpIHtcbiAgICAgICAgICAgICAgcmVzb2x2ZSh7XG4gICAgICAgICAgICAgICAgZGF0YTogW11cbiAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICByZWplY3QocmVzcG9uc2UpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0pO1xuICAgICAgICB9KTsgICAgICAgIFxuICAgICAgfSxcblxuICAgICAgZ2V0OiBmdW5jdGlvbihvcHRpb25zKSB7XG4gICAgICAgIHZhciBwYXJhbURhdGEgPSB7fTtcbiAgICAgICAgaWYgKG9wdGlvbnMuY2F0ZWdvcnkpIHtcbiAgICAgICAgICBwYXJhbURhdGEuY2F0ZWdvcnkgPSBvcHRpb25zLmNhdGVnb3J5O1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKG9wdGlvbnMubGltaXQpIHtcbiAgICAgICAgICBwYXJhbURhdGEubGltaXQgPSBvcHRpb25zLmxpbWl0O1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHBhcmFtRGF0YS5saW1pdCA9IFBhbmVpcm9Db25maWcuYXBpLmxpbWl0XG4gICAgICAgIH1cblxuICAgICAgICBpZiAob3B0aW9ucy5wYWdlKSB7XG4gICAgICAgICAgcGFyYW1EYXRhLnBhZ2UgPSBvcHRpb25zLnBhZ2U7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gamFtYm8uYWpheCh7XG4gICAgICAgICAgdXJsOiBQYW5laXJvQ29uZmlnLmFwaS51cmwgKyAnL3Byb2R1Y3RzJyxcbiAgICAgICAgICBtZXRob2Q6ICdHRVQnLFxuICAgICAgICAgIGRhdGE6IHBhcmFtRGF0YVxuICAgICAgICB9KTsgXG4gICAgICB9XG4gICAgfSxcblxuICAgIHVzZXI6IHtcbiAgICAgIGdldERhdGE6IGZ1bmN0aW9uKG9wdGlvbnMpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgICAgICBqYW1iby5hamF4KHtcbiAgICAgICAgICAgIHVybDogUGFuZWlyb0NvbmZpZy5hcGkudXJsICsgJy9hdXRoJywgICAgICAgICAgXG4gICAgICAgICAgICBkYXRhOiB7dXNlclRva2VuOiBvcHRpb25zLnVzZXJUb2tlbn0gICAgICAgICAgXG4gICAgICAgICAgfSkudGhlbihmdW5jdGlvbihyZXNwb25zZSkge1xuICAgICAgICAgICAgcmVzb2x2ZShyZXNwb25zZS5kYXRhKTtcbiAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbihyZXNwb25zZSkge1xuICAgICAgICAgICAgaWYgKHJlc3BvbnNlLnN0YXR1cyA9PT0gJ1pFUk9fUkVTVUxUUycpIHtcbiAgICAgICAgICAgICAgcmVzb2x2ZSgpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZWplY3QocmVzcG9uc2UpO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9KTsgICAgICAgIFxuICAgICAgfSxcblxuICAgICAgcmVnaXN0ZXI6IGZ1bmN0aW9uICh1c2VyRGF0YSkge1xuICAgICAgICByZXR1cm4gamFtYm8uYWpheCh7XG4gICAgICAgICAgdXJsOiBQYW5laXJvQ29uZmlnLmFwaS51cmwgKyAnL3VzZXJzJyxcbiAgICAgICAgICBtZXRob2Q6ICdQT1NUJyxcbiAgICAgICAgICBkYXRhOiB7IGRhdGE6IEpTT04uc3RyaW5naWZ5KHVzZXJEYXRhKSB9XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH0sXG5cbiAgICBwdXJjaGFzZToge1xuICAgICAgY2hlY2tvdXQ6IGZ1bmN0aW9uKG9wdGlvbnMpIHsgICAgICAgIFxuICAgICAgICByZXR1cm4gamFtYm8uYWpheCh7XG4gICAgICAgICAgdXJsOiBQYW5laXJvQ29uZmlnLmFwaS51cmwgKyAnL3B1cmNoYXNlcycsXG4gICAgICAgICAgbWV0aG9kOiAnUE9TVCcsXG4gICAgICAgICAgZGF0YTogeyBcbiAgICAgICAgICAgIGRhdGE6IEpTT04uc3RyaW5naWZ5KG9wdGlvbnMpLFxuICAgICAgICAgICAgdXNlclRva2VuOiBwYW5laXJvLnVzZXJUb2tlbiBcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH1cbiAgfTtcblxuICB2YXIgUGFuZWlyb0NvbW1vbnMgPSB7XG4gICAgY3VycmVuY3lGb3JtYXQ6IGZ1bmN0aW9uICh2YWwpIHtcbiAgICAgIHZhciBpbnRQYXJ0ID0gTWF0aC5mbG9vcih2YWwgLyAxMDApO1xuICAgICAgdmFyIGRlY2ltYWwgPSB2YWwgJSAxMDA7XG5cbiAgICAgIHZhciBjZW50cyA9IChkZWNpbWFsID4gOSkgP1xuICAgICAgICBkZWNpbWFsICsgJycgOlxuICAgICAgICAnMCcgKyBkZWNpbWFsO1xuXG4gICAgICByZXR1cm4gJ1IkICcgKyBpbnRQYXJ0ICsgJywnICsgY2VudHM7XG4gICAgfVxuICB9O1xuXG4gIHdpbmRvdy5wYW5laXJvID0gd2luZG93LnBhbmVpcm8gfHwge307XG5cbiAgd2luZG93LnBhbmVpcm8uYXBpID0gUGFuZWlyb0FwaTtcbiAgd2luZG93LnBhbmVpcm8uY29uZmlnID0gUGFuZWlyb0NvbmZpZztcbiAgd2luZG93LnBhbmVpcm8uY29tbW9ucyA9IFBhbmVpcm9Db21tb25zO1xuXG4gIHdpbmRvdy5wYW5laXJvLnVzZXJUb2tlbiA9IGphbWJvLmdldENvb2tpZSgndXNlclRva2VuJyk7XG59KSh3aW5kb3csIGRvY3VtZW50LCB1bmRlZmluZWQsIGphbWJvKTtcbiJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==
